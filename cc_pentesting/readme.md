# CC: Pen Testing

## Intro

This room provides an introduction to tools and concepts commonly encountered in penetration testing.

## \[Section 1 - Network Utilities\] - Nmap

Nmap is a very useful enumeration tool. This section will cover some of the flags, and a quick scan of a machine.

**Questions**

    1. What does nmap stand for?

Network Mapper

    2. How do you specify which port(s) to scan?

`-p`

    3. How do you do a "ping scan"(just tests if the host(s) is up)?

`-sn`

    4. What is the flag for a UDP scan? 

`-sU`

    5. How do you run default scripts?

`-sC`

    6. How do you enable "aggressive mode"(Enables OS detection, version detection, script scanning, and traceroute)?

`-A`

    7. What flag enables OS detection?

`-O`

    8. How do you get the versions of services running on the target machine?

`-sV`

    9. How many ports are open on the machine?    

1

    10. What service is running on the machine?           

apache

    11. What is the version of the service?

2.4.18

    12. What is the output of the http-title script(included in default scripts)

Apache2 Ubuntu Default Page: It works

## \[Section 1 - Network Utilities\] - Netcat

Netcat allows users to connect to specific ports and send and receive data. 

**Questions**

    1. How do you listen for connections?

`-l`

    2. How do you enable verbose mode(allows you to see who connected to you)?

`-v`

    3. How do you specify a port to listen on?

`-p`

    4. How do you specify which program to execute after you connect to a host(One of the most infamous)?

`-e`

    5. How do you connect to udp ports

`-u`

## \[Section 2 - Web Enumeration] - Gobuster

Gobuster is a tool that attempts to find valid directories on a website from a wordlist of possible directories.

**Questions**

    1. How do you specify directory/file brute forcing mode?

`dir`

    2. How do you specify dns bruteforcing mode?    

`dns`

    3. What flag sets extensions to be used?

`-x`

    4. What flag sets a wordlist to be used?

`-w`

    5. How do you set the Username for basic authentication(If the directory requires a username/password)?

`-U`

    6. How do you set the password for basic authentication?

`-P`

    7. How do you set which status codes gobuster will interpret as valid?

`-s`

    8. How do you skip ssl certificate verification?

`-k`

    9. How do you specify a User-Agent?

`-a`

    10. How do you specify a HTTP header?

`-h`

    11. What flag sets the URL to bruteforce?

`-u`

    12. What is the name of the hidden directory

secret

    13. What is the name of the hidden file with the extension xxa

password

## \[Section 2 - Web Enumeration] - Nikto

Nikto is a web scanning tool that allows users to find common web vulnerabilities. It checks for common CVW's and obtains information about the web server that is being enumerated.

**Questions**

    1. How do you specify which host to use?   

`-h`

    2. What flag disables ssl?

`-nossl`
    
    3. How do you force ssl?

`-ssl`

    4. How do you specify authentication(username + pass)?

`-id`

    5. How do you select which plugin to use?

`-plugins`

    6. Which plugin checks if you can enumerate apache users?    

apacheusers

    7. How do you update the plugin list?

`-update`

    8. How do you list all possible plugins to use?

`-list-plugins`

## \[Section 3 - Metasploit] - Intro

Metasploit is a penetration testing framework. It contains a large database of almost every major exploit, that can be used against a machine.

## \[Section 3 - Metasploit] - Setting Up

**Questions**

    1. What command allows you to search modules?

`search`

    2. How do you select a module?    

`use`

    3. How do you display information about a specific module?

`info`

    4. How do you list options that you can set?

`options`

    5. What command lets you view advanced options for a specific module?    

`advanced`

    6. How do you show options in a specific category

`show`

## \[Section 3 - Metasploit] - Selecting A Module

Practice setting up metasploit to use the eternal blue exploit.

**Questions**

    1. How do you select the eternalblue module?

`use exploit/windows/smb/ms17_010_eternalblue`

    2. What option allows you to select the target host(s)?

`RHOSTS`

    3. How do you set the target port?

`RPORT`

    4. What command allows you to set options?

`SET`

    5. How would you set SMBPass to "username"?

`SET SMBPass username`

    6. How would you set the SMBUser to "password"?

`SET SMBUser password`

    7. What option sets the architecture to be exploited?

`ARCH`

    8. What option sets the payload to be sent to the target machine?

`payload`

    9. Once you've finished setting all the required options, how do you run the exploit?

`exploit`

    10. What flag do you set if you want the exploit to run in the background?

`-j`

    11. How do you list all current sessions?

`sessions`

    12. What flag allows you to go into interactive mode with a session("drops you either into a meterpreter or regular shell")

`-i`

## \[Section 3 - Metasploit] - Meterpreter

Once an exploit is executed it will return a regular shell or a meterpreter shell. Regular shells can be upgraded to meterpreter shells with `use shell_to_meterpreter`

**Questions**

    1. What command allows you to download files from the machine?

`download`

    2. What command allows you to upload files to the machine?

`upload`

    3. How do you list all running processes?

`ps`

    4. How do you change processes on the victim host(Ideally it will allow you to change users and gain the perms associated with that user)

`migrate`

    5. What command lists files in the current directory on the remote machine?

`ls`

    6. How do you execute a command on the remote host?

`execute`

    7. What command starts an interactive shell on the remote host?

`shell`

    8. How do you find files on the target host(Similar function to the linux command "find")

`search`

    9. How do you get the output of a file on the remote host?

`cat`

    10. How do you put a meterpreter shell into "background mode"(allows you to run other msf modules while also keeping the meterpreter shell as a session)?

`background`

## \[Section 3 - Metasploit] - Final Walkthrough

```
It's time to put all the other metasploit tasks together and test them on an example machine. This machine is currently vulnerable to the metasploit module exploit/multi/http/nostromo_code_execon port 80, and this task will take you through the process of exploiting it and gaining a shell on the machine.
```

**Questions**

    1. Select the module that needs to be exploited

`use exploit/multi/http/nostromo_code_exec`

    2. What variable do you need to set, to select the remote host?

`RHOSTS`

    3. How do you set the port to 80?

`set rport 80`

    4. How do you set listening address(Your machine)

`lhost`

    5. What is the name of the secret directory in the /var/nostromo/htdocs directory?

s3cretd1r

    6. What are the contents of the file inside of the directory?

Woohoo!

## \[Section 4 - Hash Cracking] - Intro

Often times during a pen test, you will gain access to a database. When you investigate a database you will often find a users table, which contains usernames and often hashed passwords. It is often necessary to know how to crack hashed passwords to gain authentication to a website(or if you're lucky a hashed password may work for ssh!).

## \[Section 4 - Hash Cracking] -  Salting and Formatting

Regardless of the tool that is being used, almost all of the hash cracking softwares use the same or similar formats - a file with hashes in it separated by newlines.

Salts are typically appended onto the hash with a colon, and the salt. Sometimes these salts are prepended so it is important to research the type of hashing being used.

## \[Section 4 - Hash Cracking] - Hashcat

Hashcat is a popular hash cracking tool that excels at using the GPU to speed up the attack. Generally hashcat commands follow this format: `hashcat -a<attack_mode> -m<mode> <hashfile> <wordlist>`

**Questions**

    1. What flag sets the mode.

`-m`

    2. What flag sets the "attack mode"

`-a`

    3. What is the attack mode number for Brute-force    

3

    4. What is the mode number for SHA3-512    

17600

    5. Crack This Hash:56ab24c15b72a457069c5ea42fcfc640

happy

    6. 4bc9ae2b9236c2ad02d81491dcb51d5f

nootnoot

## \[Section 4 - Hash Cracking] - John The Ripper

John the ripper is a very powerful hash cracking tool that supports hash detection and comes bundled with lots of tools to make it very simple to use.

**Questions**

    1. What flag let's you specify which wordlist to use? 

--wordlist

    2. What flag lets you specify which hash format(Ex: MD5,SHA1 etc.) to use?    

--format

    3. How do you specify which rule to use?

--rules

    4. Crack this hash:5d41402abc4b2a76b9719d911017c592

hello

    5. Crack this hash:5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8

password

## \[Section 5 - SQL Injection] - Intro

SQL injection is the art of modifying a SQL query so you can get access to the targets database. This technique is often used to get users data such as passwords and emails.

## \[Section 5 - SQL Injection]: Sqlmap

Sqlmap is arguably the most popular automated SQL injection tool out there. It checks for various types of injections, and has plenty of customization options.

**Questions**

    1. How do you specify which url to check?

`-u`

    2. What about which google dork to use?

`-g`

    3. How do you select(lol) which parameter to use?(Example: in the url http://ex.com?test=1 the parameter would be test.)

`-p`

    4. What flag sets which database is in the target host's backend?(Example: If the flag is set to mysql then sqlmap will only test mysql injections).

`--dbms`

    5. How do you select the level of depth sqlmap should use(Higher = more accurate and more tests in general).

`--level`

    6. How do you dump the table entries of the database?

`--dump`

    7. Which flag sets which db to enumerate?

`-D`

    8. Which flag sets which table to enumerate?

`-T`

    9. Which flag sets which column to enumerate?

-C

    10. How do you ask sqlmap to try to get an interactive os-shell?

`--os-shell`

    11. What flag dumps all data from every table?

`--dump-all`

## \[Section 5 - SQL Injection] - A Note On Manual SQL Injection

Occasionally you will be unable to use sqlmap. This can be for a variety of reasons such as if the target has a firewall or a request limit. In this case it can be worth knowing how to test manually for HTML injection.

A list of ways to check for SQL injection can be found [here](https://owasp.org/www-community/attacks/SQL_Injection "owasp.org")

## \[Section 5 - SQL Injection] - Vulnerable Web Application

**Questions**

    1. How many types of sqli is the site vulnerable to?

3

    2. What is the name of the database?    

tests

    3. How many tables are in the database?

2

    4. What is the value of the flag?

found_me

## \[Section 6 - Samba] - Intro

Most of the pentesting techniques and tools seen so far can be used on both Linux and Windows. Samba is one of the things that will be noticed often on Windows machines and is worth understanding how to properly enumerate it. Samba is also available on Linux.

## \[Section 6 - Samba] - Smbmap

Smbmap is one of the best ways to enumerate samba. It gives the ability to run commands(with the correct permissions), downloads and upload files and perform enumeration.

**Questions**

    1. How do you set the username to authenticate with?

`-u`

    2. What about the password?    

`-p`

    3. How do you set the host?

`-H`

    4. What flag runs a command on the server(assuming you have permissions that is)?

`-x`

    5. How do you specify the share to enumerate?

`-s`

    6. How do you set which domain to enumerate?

`-d`

    7. What flag downloads a file?

`--download`

    8. What about uploading one?

`--upload`

    9. Given the username "admin", the password "password", and the ip "10.10.10.10", how would you run ipconfig on that machine

`smbmap -u "admin" -p "password" -H 10.10.10.10 -x "ipconfig"`

## \[Section 6 - Samba] - Smbclient

Smbclient allows you to do most of the things you can do with smbmap and also offers you an interactive prompt

**Questions**

    1. How do you specify which domain(workgroup) to use when connecting to the host?

`-W`

    2. How do you specify the ip address of the host?

`-I`

    3. How do you run the command "ipconfig" on the target machine?

`-c "ipconfig"`

    4. How do you specify the username to authenticate with?

`-U`

    5. How do you specify the password to authenticate with?

`-P`

    6. What flag is set to tell smbclient to not use a password?

`-N`

    7. While in the interactive prompt, how would you download the file test, assuming it was in the current directory?

`get test`

    8. In the interactive prompt, how would you upload your /etc/hosts file

`put /etc/hosts`

## \[Section 6 - Samba] - A Note About Impacket

Impacket is a collection of extremely useful windows scripts. It can be found [here](https://github.com/SecureAuthCorp/impacket"Github")

## \[Miscellaneous] - A Note On Privilege Escalation

**Privilege escalation resources**

General:

* https://github.com/swisskyrepo/PayloadsAllTheThings (A bunch of tools and payloads for every stage of pentesting)

Linux:

* https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/ (a bit old but still worth looking at)
* https://github.com/rebootuser/LinEnum (One of the most popular priv esc scripts)
* https://github.com/diego-treitos/linux-smart-enumeration/blob/master/lse.sh (Another popular script)
* https://github.com/mzet-/linux-exploit-suggester (A Script that's dedicated to searching for kernel exploits)
* https://gtfobins.github.io (I can not overstate the usefulness of this for priv esc, if a common binary has special permissions, you can use this site to see how to get root perms with it.)

Windows:
* https://www.fuzzysecurity.com/tutorials/16.html  (Dictates some very useful commands and methods to enumerate the host and gain intel)
* https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerUp (A bit old but still an incredibly useful script)
* https://github.com/411Hall/JAWS (A general enumeration script)

## \[Section 7 - Final Exam]

CTF that contains two flags

    1. What is the user.txt?

supernootnoot

    2. What is the root.txt?

congratulations!!!!

### Notes

Gobuster found a hidden directory on the webserver (`/secret`)

Gobuster then found a secret file within that directory(`/secret/secret.txt`) which contains `nyan:046385855FC9580393853D8E81F240B66FE9A7B8`

Feeding the hash to John with `/opt/john/run/john hash --wordlist=/opt/wordlist/rockyou.txt` showed that the password is `nyan`

These credentials can then be used to gain access via SSH and the user flag is obtained.

I planned to upload linPEAS for privilege escalation but first I ran the `sudo -l` command. Turns out the nyan user can run `sudo su` without a password, which will switch to the root user.

```
nyan@ubuntu:~$ sudo -l
Matching Defaults entries for nyan on ubuntu:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User nyan may run the following commands on ubuntu:
    (root) NOPASSWD: /bin/su
nyan@ubuntu:~$ sudo su
root@ubuntu:/home/nyan# 
```